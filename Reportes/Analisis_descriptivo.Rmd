---
title: 'Col Hogares: Análisis descriptivo'
author:  "Alejandro Bedoya - Sebastián Agudelo - Mateo Espinal - Juan Fernando Patiño - Estefanía Echeverry"
date: "Abril 2021"
output: 
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Carga de librerías

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
```

```{r include=FALSE}
theme_elegante <- function(base_size = 10,
                           base_family = "Raleway"
)
{
        color.background = "#FFFFFF" # Chart Background
        color.grid.major = "#D9D9D9" # Chart Gridlines
        color.axis.text = "#666666" # 
        color.axis.title = "#666666" # 
        color.title = "#666666"
        color.subtitle = "#666666"
        strip.background.color = '#9999CC'
        
        ret <-
                theme_bw(base_size=base_size) +
                
                # Set the entire chart region to a light gray color
                theme(panel.background=element_rect(fill=color.background, color=color.background)) +
                theme(plot.background=element_rect(fill=color.background, color=color.background)) +
                theme(panel.border=element_rect(color=color.background)) +
                
                # Format the grid
                theme(panel.grid.major=element_line(color=color.grid.major,size=.55, linetype="dotted")) +
                theme(panel.grid.minor=element_line(color=color.grid.major,size=.55, linetype="dotted")) +
                theme(axis.ticks=element_blank()) +
                
                # Format the legend, but hide by default
                theme(legend.position="none") +
                theme(legend.background = element_rect(fill=color.background)) +
                theme(legend.text = element_text(size=base_size-3,color=color.axis.title, family = base_family)) +
                
                theme(strip.text.x = element_text(size=base_size,color=color.background, family = base_family)) +
                theme(strip.text.y = element_text(size=base_size,color=color.background, family = base_family)) +
                #theme(strip.background = element_rect(fill=strip.background.color, linetype="blank")) +
                theme(strip.background = element_rect(fill = "grey70", colour = NA)) +
                # theme(panel.border= element_rect(fill = NA, colour = "grey70", size = rel(1)))+
                # Set title and axis labels, and format these and tick marks
                theme(plot.title=element_text(color=color.title, 
                                              size=20, 
                                              vjust=1.25, 
                                              family=base_family, 
                                              hjust = 0.5
                )) +
                
                theme(plot.subtitle=element_text(color=color.subtitle, size=base_size+2, family = base_family,  hjust = 0.5))  +
                
                theme(axis.text.x=element_text(size=base_size,color=color.axis.text, family = base_family)) +
                theme(axis.text.y=element_text(size=base_size,color=color.axis.text, family = base_family)) +
                theme(text=element_text(size=base_size, color=color.axis.text, family = base_family)) +
                
                theme(axis.title.x=element_text(size=base_size+2,color=color.axis.title, vjust=0, family = base_family)) +
                theme(axis.title.y=element_text(size=base_size+2,color=color.axis.title, vjust=1.25, family = base_family)) +
                theme(plot.caption=element_text(size=base_size-2,color=color.axis.title, vjust=1.25, family = base_family)) +
                
                # Legend  
                theme(legend.text=element_text(size=base_size,color=color.axis.text, family = base_family)) +
                theme(legend.title=element_text(size=base_size,color=color.axis.text, family = base_family)) +
                theme(legend.key=element_rect(colour = color.background, fill = color.background)) +
                theme(legend.position="bottom", 
                      legend.box = "horizontal", 
                      legend.title = element_blank(),
                      legend.key.width = unit(.75, "cm"),
                      legend.key.height = unit(.75, "cm"),
                      legend.spacing.x = unit(.25, 'cm'),
                      legend.spacing.y = unit(.25, 'cm'),
                      legend.margin = margin(t=0, r=0, b=0, l=0, unit="cm")) +
                
                # Plot margins
                theme(plot.margin = unit(c(.5, .5, .5, .5), "cm"))
        
        ret
}
```

```{r include=FALSE}
#setwd()  #Pa que definan la ruta de su directorio
educacion <- read.csv("Educación.csv",sep = ";", dec = ",")
fuerza_trabajo <- read.csv("Fuerza de trabajo.csv", sep = ";", dec = ",")
compo_hogar <- read.csv("Caracteristicas y composicion del hogar.csv", sep=";", dec=",")
datos_vivienda <- read.csv('Datos de la vivienda.csv', sep = ";", dec = ",")
uso_energetico <- read.csv('Uso de energéticos del hogar.csv', sep=";", dec = ",")
servi_hogar <- read.csv('Servicios del hogar.csv', sep = ";", dec = ",")
salud <- read.csv('Salud.csv', sep = ';', dec = ",")
```

```{r include=FALSE}
colnames(compo_hogar)[1] <- "DIRECTORIO"
colnames(educacion)[1] <- "DIRECTORIO"
colnames(fuerza_trabajo)[1] <- "DIRECTORIO"
colnames(datos_vivienda)[1] <- "DIRECTORIO"
colnames(uso_energetico)[1] <- "DIRECTORIO"
colnames(servi_hogar)[1] <- 'DIRECTORIO'
colnames(salud)[1] <- 'DIRECTORIO'
```


```{r include=FALSE}
compo_hogar$clave <- paste0(compo_hogar$DIRECTORIO, compo_hogar$SECUENCIA_P)
educacion$clave <- paste0(educacion$DIRECTORIO, educacion$SECUENCIA_P)
fuerza_trabajo$clave <- paste0(fuerza_trabajo$DIRECTORIO, fuerza_trabajo$SECUENCIA_P)
datos_vivienda$clave <- paste0(datos_vivienda$DIRECTORIO, datos_vivienda$SECUENCIA_P)
salud$clave <- paste0(salud$DIRECTORIO, salud$SECUENCIA_P)
```


```{r include=FALSE}
# Intercambio de nombres para la base de datos servicios hogar y uso_energetico
colnames(servi_hogar)[3] <- 'ORDEN'
colnames(servi_hogar)[4] <- 'SECUENCIA_P'
colnames(uso_energetico)[3] <- 'ORDEN'
colnames(uso_energetico)[4] <- 'SECUENCIA_P'
servi_hogar$clave <- paste0(servi_hogar$DIRECTORIO, servi_hogar$SECUENCIA_P)
uso_energetico$clave <- paste0(uso_energetico$DIRECTORIO, uso_energetico$SECUENCIA_P)
```

```{r include=FALSE}
#Se seleccionan las columnas directorio y P6051

clave_P6051 <- compo_hogar %>% dplyr::select(clave, P6051)
#Se cuentan el número de hijos por hogar
hijos_hogar <- clave_P6051 %>% filter(P6051 == 3) %>% count(clave)
colnames(hijos_hogar)[2] <- "Hijos"
```

```{r include=FALSE}
#Se filtra el parentezco dejando solo a los jefes de hogar
jefe_hogar <- compo_hogar %>% filter(P6051 == 1)

#Se asocian los hijos a cada jefe de hogar
hijos_jefe <- merge(jefe_hogar, hijos_hogar, by = "clave", all.x = TRUE)

#A los jefe de hogar sin hijos se les establecen cero hijos
hijos_jefe$Hijos[is.na(hijos_jefe$Hijos)] <- 0
```

```{r include=FALSE}
educacion %>% 
  filter(ORDEN==1) -> edu_filtrada; nrow(edu_filtrada)
fuerza_trabajo %>% 
  filter(ORDEN==1) -> fuerza_trabajo_filtrada; nrow(fuerza_trabajo_filtrada)
compo_hogar %>% 
  filter(ORDEN==1) -> compo_hogar_filtrada; nrow (compo_hogar_filtrada)
uso_energetico %>% 
  filter(ORDEN==1) -> uso_energetico_filtrada; nrow(uso_energetico_filtrada)
servi_hogar %>%
  filter(ORDEN==1) -> servi_hogar_filtrada; nrow(servi_hogar_filtrada)
salud %>% 
  filter(ORDEN==1) -> salud_filtrada; nrow(salud_filtrada)
```


```{r include=FALSE}
BASE_FINAL <- Reduce(function(x, y) merge(x, y, all.x = TRUE), list(hijos_jefe,
                                                                    edu_filtrada,
                                                                fuerza_trabajo_filtrada,
                                                                servi_hogar_filtrada,
                                                                uso_energetico_filtrada,
                                                                salud_filtrada))
BASE_FINAL %>% 
  relocate(Hijos, .after = 'DIRECTORIO') -> BASE_FINAL
```


```{r echo=FALSE}
# Agregando la base datos_vivienda a BASE_FINAL
BASE_FINAL <- merge(x = datos_vivienda, y = BASE_FINAL, by = 'DIRECTORIO', all.y = TRUE)
```

```{r echo=FALSE}
BASE_FILTRADA <- read.csv("BASE_FILTRADA.csv", header = TRUE)
BASE_FILTRADA <- BASE_FILTRADA[,-1]
```

Luego de la creación de la base de datos, con las variables seleccionadas, las nuevas variables, la imputación de los datos faltantes y como críterio de decisión antes de realizar modelos de machine learning, procedemos a realizar el siguiente análisis:

# Máximo nivel educativo alcanzado versus número de hijos

Una de las variables en donde podría esperarse una variación significativa en la cantidad de hijos a lo largo de sus niveles, es en el nivel educativo máximo alcanzado, en este caso, por quien sea cabeza del hogar. Esta variable cuenta con 13 niveles en respuesta a la pregunta ¿cuál es su nivel educativo más alto alcanzado? y que son los siguientes:

* 1. Ninguno
* 2. Preescolar
* 3. Básica primaria
* 4. Básica secundaria
* 5. Media
* 6. Técnico sin título
* 7. Técnico con título
* 8. Tecnológico sin título
* 9. Tecnológico con título
* 10. Universitario sin título
* 11. Universitario con título
* 12. Postgrado sin título
* 13. Postgrado con título


Véanse primero las frecuencias para esta variable.

```{r message=FALSE, warning=FALSE}
P2 <- ggplot(subset(BASE_FINAL, !is.na(P8587)), aes(x=factor(P8587)))
P2 <- P2 + geom_bar(width = 0.8, fill="blue", alpha=0.4, binwidth = 1, col='black')
P2 <- P2 + scale_x_discrete("Nivel educativo maximo") + scale_y_continuous("FRECUENCIA")
P2 <- P2 + labs(title = " Frecuencias para nivel educativo máximo")+theme_bw()
P2
```

Se observa entonces que la opción más frecuentada ha sido la de "Básica secundaria" con más de 30 mil cabezas de hogar que sólo alcanzaron dicho nivel educativo, y seguidas, aunque de bastante lejos, por la opción correspondiente a educación media, es decir, la culminación del grado 11. 

```{r message=FALSE, warning=FALSE}
P3 <- ggplot(BASE_FINAL, aes(x=factor(P8587), y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'purple',outlier.fill = 'purple',outlier.size = 1.5)+
  labs(title = 'Nivel educativo máximo alcanzado',subtitle = ' ',caption = ' ',
       x = 'Nivel educativo máximo alcanzado', y='número de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P3
```

Se observa además que si bien hay variabilidad en el tercer cuartil de algunos niveles educativos (1, 11, 12 y 13), la variable parece mantenerse bastante homogénea en lo que a su relación con la cantidad de hijos respecta. No obstante, al considerarse que esta variable puede ser de utilidad en la creación de nuevas variables, decide ser incluída en la base que se usará para el entrenamiento de los modelos. 


# P6435 Tipo de trabajo

Esta variable cuenta con los siguientes niveles:

* 1. Obrero empresa particular
* 2. Obrero empresa gubernamental
* 3. Empleado doméstico
* 4. Profesional independiente  
* 5. Trabajador independiente o por cuenta propia
* 6. Patrón o empleador
* 7. Trabajador de finca, tierra o parcela propia en arriendo
* 8. Trabajador sin remuneración
* 9. Ayudante sin remuneración
* 10. Jornalero de peón

```{r}
P4 <- ggplot(subset(BASE_FINAL, !is.na(P6435)), aes(x=factor(P6435)))
P4 <- P4 + geom_bar(width = 0.8, fill="blue", alpha=0.4, col='black' )
P4 <- P4 + scale_x_discrete("Tipo de trabajo") + scale_y_continuous("FRECUENCIA")
P4 <- P4 + labs(title = " Frecuencias para tipos de trabajo")+theme_bw()
P4
```

Los tipos de trabajos más frecuentados a nivel nacional corresponden entonces a obreros de empresa particular y a trabajadores independientes, con una notoria diferencia por sobre el resto de trabajos. 

```{r message=FALSE, warning=FALSE}
P5 <- ggplot(BASE_FINAL, aes(x=factor(P6435), y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'purple',outlier.fill = 'purple',outlier.size = 3)+
  labs(title = 'Tipo de trabajo ',subtitle = ' ',caption = ' ',
       x = 'Tipo de trabajo vs número de hijos', y='número de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P5
```

Al revisar una posible variación del número de hijos de acuerdo a los tipos de trabajo, no se observa información de mucha utilidad más allá de la breve variación en el promedio de hijos por hogar en cada tipo de trabajo (demásiado leve para parecer significativa). No obstante, se incluirá esta variable en la base de datos con que se entrenarán los modelos a fin de evaluar si en presencia de otras variables, una posible interacción toma relevancia o tiene algún tipo de influencia sobre el número de hijos. 



# P5502: Estado civil

Los encuestados responden a la siguente pregunta: **Actualmente…**

* 1. No está casado(a) y vive en pareja hace menos de dos años
* 2. No está casado(a) y vive en pareja hace dos años o más
* 3. Está viudo(a)
* 4. Está separado(a) o divorciado(a)
* 5. Está soltero(a)
* 6. Está casado(a)


```{r}
P6 <- ggplot(subset(BASE_FINAL, !is.na(P5502)), aes(x=factor(P5502)))
P6 <- P6 + geom_bar(width = 0.8, fill="blue", alpha=0.4, col='black' )
P6 <- P6 + scale_x_discrete("Estado civil") + scale_y_continuous("FRECUENCIA")
P6 <- P6 + labs(title = " Frecuencias para el estado civil del jefe de hogar")+theme_bw()
P6
```

Respecto a las frecuencias de los niveles, es de resaltar que hay disparidades entre todas la clases, no obstante, la disparidad más marcada es la que presenta el nivel 2, correspondiente a la "unión libre" o que no se está casado pero se vive en pareja hace dos años o más, seguida con bastante diferencia por la opción 6, correspondiente a "está casado".  

```{r message=FALSE, warning=FALSE}
P7 <- ggplot(BASE_FINAL, aes(x=factor(P5502), y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'purple',outlier.fill = 'purple',outlier.size = 3)+
  labs(title = 'Estado civil del jefe de hogar',subtitle = ' ',caption = ' ',
       x = 'Estado civil', y='número de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P7
```

Esta variable si logra enseñar un poco más de variación sobre la influencia de sus niveles en el número de hijos resaltando que, estar soltero, viudo o con pareja pero hace menos de dos años, son situaciones en las que los hogares poseen una cantidad menor de hijos. Esta evidencia de variación bastó para considerar esta variable dentro de la base de datos final.  


# P5000: Número de cuartos en el hogar

Variable de tipo discreto que surge como respuesta a la pregunta ¿cuántos cuartos hay en el hogar? 

```{r}
P8 <- ggplot(subset(BASE_FINAL, !is.na(P5000)), aes(x=factor(P5000)))
P8 <- P8 + geom_bar(width = 0.8, fill="blue", alpha=0.4, col='black' )
P8 <- P8 + scale_x_discrete("Número de cuartos") + scale_y_continuous("FRECUENCIA")
P8 <- P8 + labs(title = "Frecuencias número de cuartos en el hogar")+theme_bw()
P8
```

A pesar de haber personas con cantidades bastante grandes de cuartos, lo más frecuente ha sido que los hogares cuenten con 3 cuartos, con una marcada mayoría de hogares en dicha opción (más de 30 mil), seguidos aunque con gran diferencia por 4 y 2 cuartos respectivamente. 

```{r}
P9 <- ggplot(BASE_FINAL, aes(x=P5000, y=Hijos))
P9 <- P9 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
P9 <- P9 + xlab("Número de cuartos")+ylab("Cantidad de hijos")
P9 <- P9 + ggtitle("Número de cuartos en el hogar vs cantidad de hijos")+theme_bw()
P9
```

Gráficamente se puede observar una tendencia decreciente en el número de hijos por hogar cuando se superan los 6 cuartos en la vivienda, esto es que, hay evidencia de que a más cuartos en el hogar, menor el número de hijos. También es de resaltar que de 1 a 4 cuartos, la cantidad de hijos presenta un comportamiento bastante prolijo o "parejo". Dicha evidencia de decaimiento en el número de hijos conforme al número de cuartos ha sido suficiente para decidir incluirla en la base final.


# P5024: Número de sanitarios en el hogar

Esta variable, como la anterior, responde a un conteo discreto del número de sanitarios que se poseen en el hogar. Véanse entonces los gráficos de interés para esta variable.


```{r}
P10 <- ggplot(subset(BASE_FINAL, !is.na(P5024)), aes(x=factor(P5024)))
P10 <- P10 + geom_bar(width = 0.8, fill="blue", alpha=0.4, col='black' )
P10 <- P10 + scale_x_discrete("Número de sanitarios") + scale_y_continuous("FRECUENCIA")
P10 <- P10 + labs(title = "Frecuencias número de sanitarios en el hogar")+theme_bw()
P10
```

En particular, esta variable tiene un comportamiento similar en sus frecuencias al presentado por la variable de respuesta, siendo indicio de que podría resultar de utilidad en la explicación del número de hijos. Se resalta también que lo más frecuente para las viviendas encuestadas ha sido el contar con un único sanitario, con una sopresiva cantidad de más de 60 mil hogares en esta situación.  

```{r message=FALSE, warning=FALSE}
P11 <- ggplot(BASE_FINAL, aes(x=P5000, y=Hijos))
P11 <- P11 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
P11 <- P11 + xlab("Número de sanitarios")+ylab("Cantidad de hijos")
P11 <- P11 + ggtitle("Número de sanitarios en el hogar vs cantidad de hijos")+theme_bw()
P11
```

Similar a lo que sucedía con el número de cuartos se observa un patrón de decaimiento a lo largo del número de sanitarios en el hogar. Después de 6 sanitarios, la cantidad de hijos presenta una reducción considerable respecto a los hogares con menos sanitarios. Se define que se incluirá la variable en la base de datos final.  

# P5013S1: Cantidad de comidas al día

Los encuestados responden a la siguiente pregunta:

¿Con qué frecuencia preparan alimentos en este hogar? (Veces al día)

* 1. Todos los días de la semana
* 2. Cuatro a seis veces a la semana
* 3. Dos o tres veces a la semana
* 4. Una vez por semana 
* (Veces al día)

```{r}
P12 <- ggplot(subset(BASE_FINAL, !is.na(P5013S1)), aes(x=factor(P5013S1)))
P12 <- P12 + geom_bar(width = 0.8, fill="blue", alpha=0.4, col='black' )
P12 <- P12 + scale_x_discrete("Comidas al día") + scale_y_continuous("FRECUENCIA")
P12 <- P12 + labs(title = "Frecuencias para las cantidades de comidas al día")+theme_bw()
P12
```

Se observa que la gran mayoría de los datos se concentran en 3 , 2 y 1 comidas al día que preparan en la casa del jefe del hogar, sin embargo lo más frecuente son 3 comidas al día, ya que esta tiene más de 50 mil datos.

```{r message=FALSE, warning=FALSE}
P13 <- ggplot(BASE_FINAL, aes(x=P5013S1, y=Hijos))
P13 <- P13 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
P13 <- P13 + xlab("Comidas al día")+ylab("Cantidad de hijos")
P13 <- P13 + ggtitle("Comidas por día vs cantidad de hijos")+theme_bw()
P13
```


Del anterior gráfico observamos una tendencia creciente entre 1 y 3 comidas para la cantidad de hijos; sin embargo, del anterior gráfico de frecuencia se vio que la mayor proporción de personas que respondieron la encuesta realizan 3 comidas, por ende no muestra gran aporte para la predicción número de hijos en los hogares. A pesar de esto, se decide incluir para observar si en compañia de las otras variables aporta al modelo de entrenamiento.

# I_HOGAR: Ingreso mensual total del hogar

Variable continua que responde a la pregunta Ingreso mesnual total del hogar


```{r message=FALSE, warning=FALSE}
P15 <- ggplot(BASE_FINAL, aes(x=I_HOGAR, y=Hijos))
P15 <- P15 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
P15 <- P15 + xlab("Ingreso mensual")+ylab("Cantidad de hijos")
P15 <- P15 + ggtitle("Ingreso mensual vs cantidad de hijos")+theme_bw()
P15
```

Se observa un tipo de relación inversa entre ingresos del hogar y cantidad de hijos, es decir, parece ser que entre mas ingresos hay en el hogar menor cantidad de hijos hay; por esta razón se decide agregar esta variable a la base de datos.

# PERCAPITA: Ingreso per cápita del hogar

Variable continua que responde a la pregunta Ingreso per cápita  del hogar

```{r message=FALSE, warning=FALSE}
P17 <- ggplot(BASE_FINAL, aes(x=PERCAPITA, y=Hijos))
P17 <- P17 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
P17 <- P17 + xlab("Ingreso per capita del hogar")+ylab("Cantidad de hijos")
P17 <- P17 + ggtitle("Ingreso per capita del hogar vs cantidad de hijos")+theme_bw()
P17
```

Al igual que el gráfico del ingreso mensual del hogar, se observa una relación inversa entre per cápita del hogar y cantidad de hijos, es decir, a medida que hay un mayor ingreso percapita en el hogar tienden a tener una menor cantidad de hijos.

# CANT_PERSONAS_HOGAR: Cantidad de personas en el hogar

Variable discreta que responde a la cantidad de personas en el hogar. 

```{r}
P20 <- ggplot(subset(BASE_FINAL, !is.na(CANT_PERSONAS_HOGAR)), aes(x=factor(CANT_PERSONAS_HOGAR)))
P20 <- P20 + geom_bar(width = 0.8, fill="blue", alpha=0.4, col='black' )
P20 <- P20 + scale_x_discrete("Cantidad de personas en el hogar") + scale_y_continuous("FRECUENCIA")
P20 <- P20 + labs(title = "Frecuencias número de personas en el hogar")+theme_bw()
P20
```

Observando el anterior gráfico notamos que el número de personas más frecuentes en los hogares en Colombia es de 2 y 3 personas, seguido a esto existen la misma cantidad de hogares de una persona y 4 personas, según los encuestados.

```{r message=FALSE, warning=FALSE}
P21 <- ggplot(BASE_FINAL, aes(x=CANT_PERSONAS_HOGAR, y=Hijos))
P21 <- P21 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
P21 <- P21 + xlab("Cantidad de personas en el hogar")+ylab("Cantidad de hijos")
P21 <- P21 + ggtitle("Cantidad de personas en el hogar vs cantidad de hijos")+theme_bw()
P21
```

La gráfica muestra una tendencia creciente entre la cantidad de personas y el número de hijos, lo cual da a entender que entre más personas hay en el hogar, hay mayor número de hijos; con lo anterior mencionado se agrega la variable a la base de datos para ver como aporta al modelo de entrenamiento.

# P5018: Pago por consumo de energía en la ultima factura

Variable de tipo continuo en respuesta a la pregunta: ¿Cuanto pagaron EL MES PASADO o la última vez por la electricidad consumida?

```{r message=FALSE, warning=FALSE}
P23 <- ggplot(BASE_FINAL, aes(x=P5018, y=Hijos))
P23 <- P23 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
P23 <- P23 + xlab("Pago por consumo de energía")+ylab("Cantidad de hijos")
P23 <- P23 + ggtitle("Pago por consumo de energía vs cantidad de hijos")+theme_bw()
P23
```

Se nota que la mayoría de hogares pagan un valor menor de 500000 COP en su factura de la luz. Dentro de esta región la mayoría se encuentra entre 
los 0 y 4 hijos, donde el valor pagado oscila entre 0 y un poco mas de 400000 COP aunque también existe una cantidad considerable de casos 
donde se tienen entre 5 y 8 hijos y el pago de los servicios es más bajo, entre 0 y menos de 250000 COP.

# P1070: Tipo vivienda

Tipo de vivienda pueden ser los siguiente:

* 1. Casa
* 2. Apartamento
* 3. Cuarto(s)
* 4. Vivienda tradicional indigena
* 5. Otro (carpa, contenedor, vagón, embarcación, cueva, refugio natural, etc)

```{r}
P24 <- ggplot(subset(BASE_FINAL, !is.na(P1070)), aes(x=factor(P1070)))
P24 <- P24 + geom_bar(width = 0.8, fill="blue", alpha=0.4, col='black' )
P24 <- P24 + scale_x_discrete("Tipo de vivienda") + scale_y_continuous("FRECUENCIA")
P24 <- P24 + labs(title = " Frecuencias para el tipo de vivienda")+theme_bw()
P24
```

En este caso se puede apreciar que la mayoría de los encuestados viven en casas y apartamentos, una pequeña porción en otros lugares a comparación. El primer lugar lo ocupan las familias que
viven en casas, superando los 60000 casos.

```{r message=FALSE, warning=FALSE}
P25 <- ggplot(BASE_FINAL, aes(x=factor(P1070), y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'purple',outlier.fill = 'purple',outlier.size = 3)+
  labs(title = 'Boxplot para tipo de vivienda vs cantidad de hijos',subtitle = ' ',caption = ' ',
       x = 'Tipo de vivienda', y='número de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P25
```

Se puede notar que existe una buena variabilidad en este caso, ya que la diferencia entre medianas y medias es significativo.
Además se puede apreciar que los cuartiles y los máximos se diferencian para los casos 3 y 4. Notar que la mediana de las personas que viven en cuartos es similar a aquella de los que viven
en otro tipo de vivienda.

# P6020: Sexo del jefe de hogar

A consideración de nuestro grupo de trabajo y por su uso en diferentes articulos orientados al estudio de los hogares, esta variable es de vital importancia en el estudio de la cantidad de hijos en un hogar y cuenta con dos niveles:

* 1. Hombre
* 2. Mujer

```{r}
P26 <- ggplot(subset(BASE_FINAL, !is.na(P6020)), aes(x=factor(P6020)))
P26 <- P26 + geom_bar(width = 0.8, fill=c("blue","purple"), alpha=0.4, col='black' )
P26 <- P26 + scale_x_discrete("Sexo del jefe de hogar") + scale_y_continuous("FRECUENCIA")
P26 <- P26 + labs(title = "Frecuencia de cada sexo en jefes de hogar")+theme_bw()
P26
```

En la gráfica, donde se muestra la frecuencia de la variable sexo, existe una diferencia visible entre las proporciones para el sexo de los jefes del hogar, siendo la proporción de hombres cabeza de hogar casi el doble que la proporción de mujeres cabeza de hogar.

```{r message=FALSE, warning=FALSE}
P27 <- ggplot(BASE_FINAL, aes(x=factor(P6020), y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'purple',outlier.fill = 'purple',outlier.size = 3)+
  labs(title = 'Boxplot para sexo vs cantidad de hijos',subtitle = ' ',caption = ' ',
       x = 'Sexo', y='número de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P27
```

A pesar de la diferencia de proporciones entre los niveles de la variable sexo, cuando se compara sexo contra cantidad de hijos por hogar en esta gráfica, no existe mucha variación entre los niveles de la variable. A pesar de esto, permanecerá en nuestra base de datos final para comprobar si su interacción con las otras variables es significativa para la prediccón de la cantidad de hijos de un hogar.

# P6127: Estado de salud

Esta variable, que corresponde a la pregunta ¿ El estado de salud de _ en general, es:?, cuenta con cuatro niveles:

* 1. Muy bueno
* 2. Bueno
* 3. Regular
* 4. Malo


```{r}
P30 <- ggplot(subset(BASE_FINAL, !is.na(P6127)), aes(x=factor(P6127)))
P30 <- P30 + geom_bar(width = 0.8, fill=c("blue", "purple", "blue","blue"), alpha=0.4, col='black' )
P30 <- P30 + scale_x_discrete("Estado de salud") + scale_y_continuous("FRECUENCIA")
P30 <- P30 + labs(title = " Frecuencias para los estados de salud")+theme_bw()
P30
```

De la gráfica se podría deducir que en colombia por lo general los jefes de hogar cuentan con una buena salud aunque existe una gran proporción de jefes de hogar con un estado de salud regular.

```{r message=FALSE, warning=FALSE}
P31 <- ggplot(BASE_FINAL, aes(x=factor(P6127), y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'purple',outlier.fill = 'purple',outlier.size = 3)+
  labs(title = 'Boxplot para estado de salud vs número de hijos',subtitle = ' ',caption = ' ',
       x = 'Estado de salud', y='número de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P31
```

Aunque no se observa una gran variabilidad entre los tres primeros niveles de la variable Estado de salud cuando se gráfica vs Hijos, el nivel que representa una mala salud si difiere de los demás y por ende se decide conservar la variable para verificar su importancia en los modelos.


# Edad_maxima: Variable construida

Esta variable, que corresponde a la edad máxima entre el cabeza de hogar y su cónyuge (o pareja), se decide crear en vista de que la edad de ambos por separado mostraba una gran importancia para la cantidad de hijos de un hogar.

```{r}
h36 <- ggplot(BASE_FILTRADA, aes(x=edad_maxima))
h36 <- h36 + geom_histogram(binwidth = 1, col='black', fill='blue', alpha=0.4)
h36 <- h36 + xlab("Edad máxima entre el cabeza de hogar y su pareja")+ylab("FRECUENCIA")
h36 <- h36 + ggtitle("HISTOGRAMA DE FRECUENCIAS PARA LA EDAD MAXIMA")+theme_bw()
h36
```

Las edades máximas más recurrentes entre las cabezas de hogar y su cónyuge en el estudio, se encuentran entre los 30 y 60 años (aproximadamente). Esta es una variable que, a priori, puede considerarse determinante y podría esperarse tenga alguna influencia bien sea directa o conjunta sobre la cantidad de hijos. Se cree que una pareja con edades entre los 35 y 50 años, es más propensa a tener más hijos que una pareja de menores de 25 años. 

```{r}
P37 <- ggplot(BASE_FILTRADA, aes(x=edad_maxima, y=Hijos))
P37 <- P37 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
P37 <- P37 + geom_vline(xintercept = c(28,65))
P37 <- P37 + xlab("Edad maxima")+ylab("Cantidad de hijos")
P37 <- P37 + ggtitle("Edad maxima vs cantidad de hijos")+theme_bw()
P37
```

A pesar de tener una densidad bastante considerable a lo largo de las edades, es de rescatar que los picos para la variable cantidad de hijos se encuentran en un segmento de edades esperables y acordes a la suposición previa. Las parejas entre los 28 y los 65 años, han reportado cantidades mayores de hijos. Además, al revisar la correlación entre ambas variables, se observa una correlación negativa de -0.231, que sirve de insumo para esperar una posible relación entre ambas variables. Este indicio ha bastado para determinar que esta variable se incluirá en la base de datos final con que se entrenarán los modelos.

# Con_pareja: Variable construida

Para ajustar un pequeño problema con los NA's encontrados en la variable P6071 que representa ¿El (la) cónyuge de___vive en este hogar?, por intuición se decidió inferir que los datos en NA se debian a que el jefe de hogar no tenía pareja o cónyuge, y por esto de decidió crear una variable que nos dijera si los jefes de hogar viven con pareja y si no (incluyendo si no tenían pareja). Por tanto, sus niveles fueron:

* 1. Vive en el hogar con pareja.
* 2. Vive en el hogar sin pareja ó no tiene pareja.


```{r}
P38 <- ggplot(subset(BASE_FILTRADA, !is.na(con_pareja)), aes(x=factor(con_pareja)))
P38 <- P38 + geom_bar(width = 0.8, fill=c("blue", "purple"), alpha=0.4, col='black' )
P38 <- P38 + scale_x_discrete("Jefe sólo o con pareja ") + scale_y_continuous("FRECUENCIA")
P38 <- P38 + labs(title = " Frecuencias para jefes de hogar con pareja en el hogar o sin pareja")+theme_bw()
P38
```

De las gráfica de frencuencias de esta nueva variable se puede apreciar que las proporciones de hogares donde el jefe de hogar que vive con pareja y en los que el jefe de hogar no vive con pareja ó esta soltero son muy similares.

```{r message=FALSE, warning=FALSE}
P39 <- ggplot(BASE_FILTRADA, aes(x=factor(con_pareja), y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'purple',outlier.fill = 'purple',outlier.size = 3)+
  labs(title = 'Estado sentimental vs número de hijos',subtitle = ' ',caption = ' ',
       x = 'Estado sentimental', y='número de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P39
```

De esta gráfica que llamamos "Estado sentimental vs número de hijos" podemos aprencia una leve variación entre ambos niveles de la variable creada con respecto al número de hijos. Lo cual, nos hace inferir su importancia en la predicción del número de hijos.



